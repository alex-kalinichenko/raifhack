# Хакатон RaifHack 2021

**Сайт**: https://raifhack.ru

**Результат**: 152 место из 377 команд с общим количеством участников ~1500 человек.

**Скор**: 1.49469 / 1.39329 на public / private. 

**Лучшее решение находится в ноутбуке `solution_09.ipynb`**.

## Что было сделано
**Увеличило скор**:

- boosting type `dart`на LightGBM
- гиперпараметры подобранные **Optuna**
- ручная обработка признака `floor`:
  - замена `Nan`, `цоколь` и прочего на 1
  - `подвал` и `-1` на  -1
  - `1, подвал` и `подвал , 1` и подобное на -0.5,
  - все остальные нечисловые описания по типу `Цоколь, 1,2(мансарда)` приравнены к нулю.
- `label encoding` для 'region', 'city', 'street', 'realty_type', 'osm_city_nearest_name', 'date'
- Обучение только на объектах в которых цена оценена вручную: `['price_type'] == 1`
- Предикт домножается на 0.94

**Не увеличилл скор**:
- гиперпараметры с Kaggle
- AutoVIML

## Что можно ещё было сделать 
- Многие успешно пользовались [LightAutoML](https://github.com/sberbank-ai-lab/LightAutoML)
- AutoWoe (пример использования тут: https://www.kaggle.com/alexryzhkov/lightautoml-interpretable-model-autowoe). При помощи этой либы можно не только получить интерпретируемую модель, но и а) автоматический отчет о разработке и б) автоматический sql запрос по модели для инференса :)
- использовать метрику от организаторов в качестве лосса
- Кроссвалидацию (хотя она никому не помогла)
- объеденить высокоэтажные в одну или несколько категорий
- выбросить строки с нанами
- заполнить наны street ближайшими (соседями)
- Логарифмирование. Изначально распределение переменной является лог-нормальным (очень похожим на него), а значит применение логарифма переводит распределение в сильно похожее на нормальное - модели сильно проще с ним работать. Происходит это из-за того, что правый массивный хвост «сжимается» логарифмом.
- учить модельку на price_type=0 и ее предикты кидать в кусочек для price_type=1 и тест как фичу чтобы поверх учить модельку

## Лучшие публичные решения:

- Векторизированная метрика, которая считается в более чем 100 раз быстрее той, что через цикл сделана организаторами:
```python
def deviation_metric_vec(y_true: np.array, y_pred: np.array) -> float:
    deviation = (y_pred - y_true) / np.maximum(1e-8, y_true)
    
    metr = deviation * 0.0 + 9
    
    metr[np.abs(deviation) <= THRESHOLD] = 0
    
    metr[deviation <= - 4 * THRESHOLD] = 9 * NEGATIVE_WEIGHT
    
    mask = (-4 * THRESHOLD < deviation) & (deviation < -THRESHOLD)
    metr[mask] = NEGATIVE_WEIGHT * ((deviation[mask] / THRESHOLD) + 1) ** 2
    
    mask = (deviation < 4 * THRESHOLD) & (deviation > THRESHOLD)
    metr[mask] = ((deviation[mask] / THRESHOLD) - 1) ** 2
    
    return metr.mean()
```
- Для LightAutoML решения, стоит использовать с правильно заданными лоссом и метрикой. То есть task = Task('reg', loss='mae', metric=deviation_metric_vec, greater_is_better=False) https://t.me/c/1489786809/6766

### Ссылки на лучшие публичные решения
#лучшеепубличноерешение или #special из чата http://t.me/joinchat/CAVGpBxTlV4qPjx0d8_IZg
- https://github.com/BatyaZhizni/Raifhack-DS - https://t.me/c/1489786809/6806
- https://github.com/AlexBot1974/predictor_real_estae - https://t.me/c/1489786809/6842
- https://github.com/LevSV/RAIFHACK - https://t.me/c/1489786809/6905
- https://github.com/traptrip/raifhack_public/tree/main - https://t.me/c/1489786809/6976
- https://github.com/akillarionov/raifhack - 
- https://github.com/maks-sh/raifhack_baseline
- https://github.com/VovanMC/raifhack_2021_solution
- https://github.com/RadmirZ/-dspyt.com-final-submission
- https://github.com/Edgoo/hackathon

#### Запуск бейзлайна
`python train.py --train_data '../../data/2021_raifhack/data/train.csv' --model_path solution_03_model.pkl`

`python predict.py --test_data ../../data/2021_raifhack/data/test.csv --model_path solution_03_model.pkl --output ../../data/2021_raifhack/output/02/solution_03.csv`

#### Использование облачного решения `Selectel` 
- Как подключаться к Selectel https://www.youtube.com/watch?v=y4ecuhYMjzM
- Чтобы быстро запустить JupyterLab, введите в адресной строке браузера `http://ip_адрес_сервера`. Пароль по умолчанию: `ikieg2wahmohtahF`  https://kb.selectel.ru/docs/selectel-cloud-platform/main-services/cloud-servers/data_science_virtual_machine/
- Самый быстрый регион 9-й в Питере.
- Использовался сервер Ubuntu 18.04 LTS Machine Learning 64-bit
  - vCPU 4 ядра
  - 8 Гб
  - 30 Гб быстрый диск
  - Новый плавающий IP-адрес

# Итоговый лидерборд


| Место   | Команда                                                | Скор                   | Итоговый  скор         | Кол-во  загрузок |
| ------- | ------------------------------------------------------ | ---------------------- | ---------------------- | ---------------- |
| 1       | Звездочка                                              | 1.1018832754602756     | 0.9678250384392454     | 23               |
| 2       | Козуэй-Бей                                             | 1.120304395689825      | 0.9680317254284414     | 18               |
| 3       | Kanape                                                 | 1.15342638987386       | 0.9900381320088042     | 26               |
| 4       | dwayne  Scala JSON                                     | 1.2031672580316461     | 0.9939717268929027     | 30               |
| 5       | Десять  волкодней                                      | 1.1495109185233217     | 0.996953369142201      | 28               |
| 6       | GG                                                     | 1.1311021409919508     | 0.9987531903847917     | 29               |
| 7       | bbbb                                                   | 1.2115586990581544     | 1.0011652921514929     | 28               |
| 8       | BaselineSolution                                       | 1.1539000057519913     | 1.0053798798135964     | 30               |
| 9       | Curious  insight                                       | 1.2111814745563825     | 1.0067648863080663     | 20               |
| 10      | BigSberBosses                                          | 1.214401889882953      | 1.0075642312790565     | 24               |
| 11      | Magic  City                                            | 1.1635483034573924     | 1.0226939557907984     | 29               |
| 12      | Lucky  random seed                                     | 1.215796212791345      | 1.0339441204153264     | 11               |
| 13      | RaifKaif                                               | 1.2034979965300294     | 1.037767352198549      | 23               |
| 14      | OldSchool                                              | 1.162713485619043      | 1.04061357247918       | 30               |
| 15      | DreamTeam                                              | 1.2252609899083104     | 1.0417699695719576     | 15               |
| 16      | AR                                                     | 1.3082874644449538     | 1.0475432496049897     | 18               |
| 17      | Ural  Bears                                            | 1.2212479105708716     | 1.0535219417241024     | 30               |
| 18      | Peaky  Blinders                                        | 1.2622145966352925     | 1.0539761560628296     | 29               |
| 19      | компетитив  но при этом                                | 1.1432835346421673     | 1.0553653568106676     | 30               |
| 20      | flow                                                   | 1.2823319226767969     | 1.0560635841208061     | 27               |
| 21      | observer                                               | 1.2073153122710347     | 1.0580371663843413     | 30               |
| 22      | fp  mid no roll                                        | 1.2285905942742987     | 1.0582449164469878     | 30               |
| 23      | Gornyaki                                               | 1.1765973111230843     | 1.0583062102619902     | 29               |
| 24      | Toyota  Production System                              | 1.231165273197767      | 1.0614051995924916     | 30               |
| 25      | WhileTrue                                              | 1.2373098911332598     | 1.065269061343971      | 24               |
| 26      | Equity  Charger                                        | 1.17889691385168       | 1.0653350038963576     | 30               |
| 27      | RetardTeam                                             | 1.209428664888745      | 1.0654086936141283     | 22               |
| 28      | Зачем  вы опять красите этот забор вопросительный знак | 1.2276011349099607     | 1.0668589981641015     | 29               |
| 29      | Ком                                                    | 1.2252281603794761     | 1.0689882087735918     | 30               |
| 30      | Average  .fit enjoyer                                  | 1.2956623442150208     | 1.069496764306634      | 29               |
| 31      | 404  found                                             | 1.2691014657953423     | 1.0731475406395496     | 30               |
| 32      | 402  payment required                                  | 1.2178258783698126     | 1.0738095391010096     | 19               |
| 33      | Myzhiki                                                | 1.231289970991089      | 1.0749919417693403     | 24               |
| 34      | The  Pythons                                           | 1.3102831761934288     | 1.0763160927041853     | 19               |
| 35      | Two  Unknown Geese                                     | 1.2587639739813723     | 1.0797376305053656     | 19               |
| 36      | Digital  Rover                                         | 1.2582566727117235     | 1.0800543364653408     | 26               |
| 37      | tiesiog                                                | 1.2516764913367457     | 1.0806856533623261     | 22               |
| 38      | Fresh  AIR                                             | 1.320518299694489      | 1.0807952386789925     | 26               |
| 39      | paranormal                                             | 1.1952756901585937     | 1.082372651036747      | 17               |
| 40      | Labean                                                 | 1.3036647796839733     | 1.0832445094160645     | 19               |
| 41      | randomseed19                                           | 1.2880001446990033     | 1.084211908324208      | 12               |
| 42      | Япики                                                  | 1.2946966676799687     | 1.0858404536981556     | 27               |
| 43      | Team  RTX4090                                          | 1.238092379361251      | 1.0859546782933533     | 30               |
| 44      | Rabooging                                              | 1.3016426887761652     | 1.08980058049339       | 28               |
| 45      | UnderBridge                                            | 1.3106540937881657     | 1.090219892700441      | 30               |
| 46      | Пяткой  в небо                                         | 1.2955666907153987     | 1.0910045634642402     | 13               |
| 47      | Сигаретку  и от дефа                                   | 1.2497077495503763     | 1.0928776352783303     | 17               |
| 48      | AII                                                    | 1.2973880381627723     | 1.0953197900339244     | 18               |
| 49      | хорошие  парни                                         | 1.227512137477366      | 1.0973479164448592     | 29               |
| 50      | Братство  Кольца                                       | 1.2922871145527837     | 1.097984894659354      | 26               |
| 51      | Cactus                                                 | 1.2707905071787367     | 1.1005032034618223     | 24               |
| 52      | 89P13                                                  | 1.3162747552671243     | 1.1034128973270736     | 22               |
| 53      | Promising                                              | 1.2586094333763806     | 1.1059065098584175     | 25               |
| 54      | GDT                                                    | 1.3757991391416071     | 1.1077569343213727     | 15               |
| 55      | Жили  были                                             | 1.3139829923629407     | 1.1126571785847834     | 18               |
| 56      | dondadonda                                             | 1.2903318210779091     | 1.1147731415687137     | 30               |
| 57      | Real  Estate Connoisseurs                              | 1.312067643600537      | 1.1153842149810256     | 8                |
| 58      | Nuclear  Foxes Team                                    | 1.3426285408309677     | 1.1190699815767504     | 14               |
| 59      | KaGeLol                                                | 1.2203426739996317     | 1.120147119324126      | 30               |
| 60      | House  Prices - Advanced Regression Techniques         | 1.2570210485660238     | 1.1218976015179887     | 25               |
| 61      | Уцышки                                                 | 1.279994721202472      | 1.1333556038875292     | 30               |
| 62      | Key  Piper                                             | 1.3145969800175905     | 1.1360410839196122     | 21               |
| 63      | GoodFit                                                | 1.3102473589654604     | 1.1387508619203648     | 22               |
| 64      | Sarafanchik                                            | 1.2390303013711181     | 1.142349672396023      | 25               |
| 65      | team_date                                              | 1.3425216608938824     | 1.1435519737663324     | 29               |
| 66      | Naive  Bayes                                           | 1.3835244034584298     | 1.1441201000126722     | 19               |
| 67      | Та  Ша                                                 | 1.3241658983083693     | 1.1526781683397256     | 25               |
| 68      | гранb                                                  | 1.2981225733524804     | 1.1537207689418634     | 14               |
| 69      | Team  WRW                                              | 1.3212412592361285     | 1.1556953255496976     | 29               |
| 70      | Alvani                                                 | 1.3610445933731816     | 1.1590221606651085     | 22               |
| 71      | NN-team                                                | 1.33738622650096       | 1.1611918633530474     | 30               |
| 72      | MLao                                                   | 1.2818165212393484     | 1.1634356534150054     | 25               |
| 73      | CUDA-туда                                              | 1.2634848699510466     | 1.166780141830136      | 22               |
| 74      | BeeAnalyst                                             | 1.4095830674544427     | 1.1703612919012305     | 10               |
| 75      | Bismark                                                | 1.4642269460097732     | 1.170649252443263      | 21               |
| 76      | Team  sanchez                                          | 1.3544622592770335     | 1.1782251563965642     | 15               |
| 77      | gradient_descent                                       | 1.351715058143697      | 1.178458499533406      | 20               |
| 78      | Power  Rangers                                         | 1.290325765384661      | 1.1803034576864193     | 30               |
| 79      | Pbd                                                    | 1.4250183619179897     | 1.1816009935203606     | 17               |
| 80      | Попытка  номер 0                                       | 1.3337989281091385     | 1.1867348754402054     | 9                |
| 81      | Казан                                                  | 1.492193099105902      | 1.1870392201435167     | 4                |
| 82      | RAI                                                    | 1.2775238257923396     | 1.1903989884584552     | 23               |
| 83      | Martina                                                | 1.2862003762835745     | 1.190596968414826      | 29               |
| 84      | UT                                                     | 1.352835578291997      | 1.1959590330157102     | 7                |
| 85      | Solo_stranger                                          | 1.3250911592488432     | 1.196420165832269      | 13               |
| 86      | Sophisto                                               | 1.331193981668683      | 1.197445355307822      | 20               |
| 87      | BTE                                                    | 1.3760951271639328     | 1.1977758748504348     | 30               |
| 88      | VeniVidiVici                                           | 1.3597900303121295     | 1.2007631408296615     | 25               |
| 89      | ZnakTeam                                               | 1.3051258951429763     | 1.2051613582682055     | 26               |
| 90      | Art  Solo                                              | 1.388027824815031      | 1.2103150910160774     | 5                |
| 91      | ScanGeos                                               | 1.4262650900266305     | 1.2122529210463777     | 19               |
| 92      | Money  Miners                                          | 1.3789974395576958     | 1.2198521596280165     | 17               |
| 93      | tensor                                                 | 1.3600565612644275     | 1.2245405001798977     | 26               |
| 94      | GolloBond                                              | 1.3602185953742985     | 1.2281756144987863     | 17               |
| 95      | SRLC                                                   | 1.3602157546089038     | 1.2281756144987863     | 13               |
| 96      | qwerty123                                              | 1.3602185953742985     | 1.2281756144987863     | 30               |
| 97      | PredictTeam                                            | 1.3602185953742985     | 1.2281756144987863     | 14               |
| 98      | TeaNella                                               | 1.3602185953742985     | 1.2281756144987863     | 19               |
| 99      | Peace  Data                                            | 1.3135656841929        | 1.229667633129604      | 27               |
| 100     | 4GB                                                    | 1.3760566017666391     | 1.2324481479861555     | 21               |
| 101     | 4NN                                                    | 1.3738506657037555     | 1.232820399349892      | 25               |
| 102     | KoshkarovSemyon                                        | 1.3650438142639587     | 1.2352099615845358     | 23               |
| 103     | R                                                      | 1.3261788962676564     | 1.23810605169847       | 17               |
| 104     | Dspyt.com                                              | 1.4062123483345823     | 1.2401043331792863     | 29               |
| 105     | BunchofGeeks                                           | 1.451922869908448      | 1.2414408652218092     | 26               |
| 106     | Smile                                                  | 1.4965358377567162     | 1.2464834130452305     | 24               |
| 107     | DataLens                                               | 1.5083967978451034     | 1.2560028519871558     | 1                |
| 108     | Lonely  Farmer                                         | 1.5375398196206518     | 1.2586784411773992     | 15               |
| 109     | Crystal                                                | 1.3389664216734178     | 1.2624929883878055     | 20               |
| 110     | 12  случайных величин                                  | 1.4065234418221928     | 1.2646907390584385     | 14               |
| 111     | SandTeam                                               | 1.4551460866455719     | 1.2735808471790528     | 13               |
| 112     | Random  Seed                                           | 1.4553095010045198     | 1.2743428054687678     | 20               |
| 113     | v5                                                     | 1.4812171985296685     | 1.2748162582011766     | 12               |
| 114     | Моделисты                                              | 1.47049976119004       | 1.274900683701854      | 10               |
| 115     | trololo                                                | 1.439507736396008      | 1.2749593004385569     | 20               |
| 116     | Cosinus  v apelsinus                                   | 1.5039324005388963     | 1.2773857937941409     | 24               |
| 117     | Oilgas                                                 | 1.5240380626964796     | 1.2787903211079834     | 6                |
| 118     | AI-Artel                                               | 1.476475040607625      | 1.2799436009882401     | 19               |
| 119     | surfing  BERT                                          | 1.4712393271060993     | 1.2868040356068906     | 8                |
| 120     | Команда  A                                             | 1.4039360681423778     | 1.2871725613299234     | 18               |
| 121     | TorPut2036                                             | 1.4194335406210798     | 1.2879613481927166     | 19               |
| 122     | Team  Serokell                                         | 1.4624215670016514     | 1.2934629212728896     | 19               |
| 123     | 2can                                                   | 1.4055762053462753     | 1.305589553905892      | 25               |
| 124     | The  one                                               | 1.4267793929313974     | 1.307638615289856      | 12               |
| 125     | 54bf4ef4-158c-11ec-82a8-0242ac130003                   | 1.4047623180836888     | 1.3094398228797126     | 30               |
| 126     | Boomers                                                | 1.4253789332593196     | 1.3187010403469481     | 6                |
| 127     | Ящерка                                                 | 1.4253789332593196     | 1.3187010403469481     | 8                |
| 128     | Batya  Zhizni                                          | 1.4239115385003924     | 1.3187010403469481     | 26               |
| 129     | Lakehouse                                              | 1.4253789332593196     | 1.3187010403469481     | 3                |
| 130     | Hash  it Out                                           | 1.4408603698398728     | 1.3190849628415633     | 5                |
| 131     | AppChr                                                 | 1.435257867330244      | 1.3191411335893728     | 13               |
| 132     | Stealth  mode team                                     | 1.4113893006129368     | 1.3200937267856165     | 26               |
| 133     | boosting_embeddings                                    | 1.4253789332593196     | 1.3224957274673959     | 13               |
| 134     | lean_team_appraisal_machine                            | 1.4398603067756455     | 1.3264880201221956     | 1                |
| 135     | maximax                                                | 1.3738482330989983     | 1.3264886153895943     | 14               |
| 136     | Cloud_9                                                | 1.4770224979260147     | 1.3299571220540043     | 24               |
| 137     | Team  Honed                                            | 1.3715384395266463     | 1.3331302541322034     | 30               |
| 138     | J_K                                                    | 1.420021139686468      | 1.3464704884907361     | 11               |
| 139     | Shishki                                                | 1.4256405433447448     | 1.3473180961732019     | 22               |
| 140     | ceet                                                   | 1.4605487600375548     | 1.348091689361041      | 30               |
| 141     | DataHack                                               | 1.588729234602549      | 1.3509719482511813     | 25               |
| 142     | BatchNormITakSoydet                                    | 1.4750857786976745     | 1.3516732780778937     | 19               |
| 143     | Команда  УИИ                                           | 1.5193685682918616     | 1.352460090615585      | 23               |
| 144     | kks_ml                                                 | 1.5735448362574116     | 1.3538988754220498     | 5                |
| 145     | Колбастеры                                             | 1.4093813595995806     | 1.3560188853833572     | 7                |
| 146     | HeyTeam                                                | 1.4871766602510683     | 1.3646377078553027     | 17               |
| 147     | StardustCrusaders                                      | 1.7156078082633388     | 1.3741074468603451     | 13               |
| 148     | myteam                                                 | 1.4772010891481557     | 1.3806792138095705     | 16               |
| 149     | halftundra                                             | 1.5059471220924778     | 1.3848149329490353     | 9                |
| 150     | Felis  Catus Invictus                                  | 1.601059958190786      | 1.3911344858621046     | 22               |
| 151     | Mike                                                   | 1.5716121671222327     | 1.3917606091069865     | 18               |
| **152** | **Team**                                               | **1.4946941059642656** | **1.3932947479132833** | **15**           |
| 153     | TeamSlices                                             | 1.4518840923845944     | 1.3958169412597943     | 5                |
| 154     | orexi                                                  | 1.5377244557733594     | 1.4235817340501586     | 23               |
| 155     | Решалы                                                 | 1.5943446454275676     | 1.4310555883623504     | 18               |
| 156     | While  True                                            | 1.6538156576698706     | 1.4451857230257978     | 6                |
| 157     | Melon  Tusk                                            | 1.5592669001373152     | 1.4495982669460352     | 12               |
| 158     | fully-gift-grass-write-буткемперы                      | 1.6808812017495935     | 1.480391674510264      | 7                |
| 159     | Average  ML Enjoyers                                   | 1.6422049002292756     | 1.4839998300959438     | 19               |
| 160     | Real  Estate Renegades                                 | 1.5607081257320172     | 1.487739098303929      | 24               |
| 161     | Made  As Described Earlier                             | 1.6552541528322537     | 1.4889484603811804     | 22               |
| 162     | TeamV                                                  | 1.6321501866910646     | 1.4905775505584913     | 12               |
| 163     | YeBl  team                                             | 1.5552440024133591     | 1.493580285339166      | 9                |
| 164     | Data  Castores                                         | 1.7824203962712706     | 1.4943419892049736     | 11               |
| 165     | DS17                                                   | 1.7829639226053333     | 1.4954135202669057     | 7                |
| 166     | CityGrows                                              | 1.6022474500233692     | 1.4957792436143853     | 26               |
| 167     | Fit_predict_profit                                     | 1.5674189895933377     | 1.4978944331324668     | 15               |
| 168     | Hackathon                                              | 1.6321386764552956     | 1.5017724934703458     | 17               |
| 169     | DrMichaelBurry                                         | 1.6343186161977958     | 1.5113867835170383     | 14               |
| 170     | CyberElite                                             | 1.5844447700106519     | 1.5233070246094564     | 20               |
| 171     | The  Nest                                              | 1.85334320223786       | 1.5245920036000786     | 7                |
| 172     | Shiny                                                  | 1.7277641376689223     | 1.5253482226304973     | 11               |
| 173     | DataLab                                                | 1.7745295367641638     | 1.5253711023822343     | 22               |
| 174     | DST-OFF                                                | 1.708010609750665      | 1.5337987873854009     | 1                |
| 175     | DataSlon                                               | 1.8289006007489688     | 1.534593717422529      | 8                |
| 176     | We  dont leak any more                                 | 1.681940179519748      | 1.5399275453360155     | 13               |
| 177     | Greenfield                                             | 1.668531643502019      | 1.5463199906284901     | 4                |
| 178     | PyPyPy                                                 | 1.530067579333573      | 1.550559813659782      | 22               |
| 179     | Subsoul                                                | 1.68848082573664       | 1.5506297691930373     | 21               |
| 180     | ABCo                                                   | 1.7121919430950079     | 1.5515132441919695     | 11               |
| 181     | WOWCOMMAND                                             | 1.7732157847422876     | 1.5599330820867532     | 6                |
| 182     | HOLY  GANG                                             | 1.7528737601196198     | 1.560550240407495      | 30               |
| 183     | Team  Hobbyists                                        | 1.8085828250431637     | 1.5620022194230583     | 9                |
| 184     | Ralf  team                                             | 1.6079652949599452     | 1.5684831908143775     | 11               |
| 185     | Sharp  minds                                           | 1.7086871052367245     | 1.5745253866882738     | 13               |
| 186     | poRIDGE                                                | 1.702655700887803      | 1.5776164017193586     | 12               |
| 187     | Alternative  modeling                                  | 1.6484041642044347     | 1.5781005755363133     | 7                |
| 188     | G4                                                     | 1.8570369691018405     | 1.5830908873782692     | 7                |
| 189     | SoloD                                                  | 1.791296124920791      | 1.584001932068959      | 23               |
| 190     | JT                                                     | 1.7629612437600317     | 1.597334342970372      | 13               |
| 191     | bruh                                                   | 1.8024904641525008     | 1.5975080824153614     | 7                |
| 192     | MEPHIandGeeks                                          | 1.8570369691018405     | 1.6009262379161098     | 18               |
| 193     | Team  Inessa                                           | 1.8688978720327163     | 1.601706451509901      | 2                |
| 194     | RHScience                                              | 1.8688978720327163     | 1.601706451509901      | 3                |
| 195     | TRAPXATA                                               | 1.7395105745160673     | 1.609336739453724      | 11               |
| 196     | Novel                                                  | 1.84041558125607       | 1.609551205795192      | 8                |
| 197     | Six  hot loads                                         | 1.7868480960032413     | 1.6099007921452477     | 11               |
| 198     | GoodLuckTeam                                           | 1.8156090148671893     | 1.6127420856958967     | 4                |
| 199     | TiltAI                                                 | 1.8519384239454262     | 1.6129946833800852     | 8                |
| 200     | Градиентный  подъем                                    | 1.8661056619721095     | 1.6143804149468497     | 7                |
| 201     | Arctic                                                 | 1.8439074377524887     | 1.6152585489792406     | 6                |
| 202     | Moscow  Data Science                                   | 1.8285698050751398     | 1.6158898741440302     | 9                |
| 203     | Леша  и Дэвид                                          | 1.8834733748119308     | 1.6207214023544367     | 5                |
| 204     | Portafortuna                                           | 1.8674705924788415     | 1.6218179865161009     | 2                |
| 205     | Comet                                                  | 1.7859884477940295     | 1.6232843686999976     | 13               |
| 206     | KEKDATA                                                | 1.8750737480324913     | 1.6244356316066029     | 3                |
| 207     | Team  Financial                                        | 1.8750737480324913     | 1.6244356316066029     | 13               |
| 208     | Газы                                                   | 1.8636839131795488     | 1.6244356316066029     | 7                |
| 209     | killer  coders                                         | 1.8750737480326047     | 1.624435631606659      | 1                |
| 210     | aartemiev                                              | 1.8215466587151838     | 1.624435631606659      | 3                |
| 211     | Green  Machine                                         | 1.8750737480326047     | 1.624435631606659      | 1                |
| 212     | Going  Merry                                           | 1.8750737480326047     | 1.624435631606659      | 5                |
| 213     | SunStar                                                | 1.8750737480326047     | 1.624435631606659      | 3                |
| 214     | HackEmAll                                              | 1.8750737480326047     | 1.624435631606659      | 2                |
| 215     | Tretiy_Tost                                            | 1.8750737480326047     | 1.624435631606659      | 1                |
| 216     | DataHackerz                                            | 1.8750737480326047     | 1.624435631606659      | 1                |
| 217     | _OptimuSGang                                           | 1.8750737480326047     | 1.624435631606659      | 1                |
| 218     | Futorio  Franklin                                      | 1.8750737480326047     | 1.624435631606659      | 3                |
| 219     | na_style                                               | 1.8750737480326047     | 1.624435631606659      | 4                |
| 220     | Inter  Analytics                                       | 1.8750737480326047     | 1.624435631606659      | 1                |
| 221     | GreenTeam                                              | 1.8750737480326047     | 1.624435631606659      | 2                |
| 222     | Ибриум                                                 | 1.8215466587151838     | 1.624435631606659      | 3                |
| 223     | It  is not rocket science                              | 1.8750737480326047     | 1.624435631606659      | 3                |
| 224     | Тёма  G                                                | 1.8750737480326047     | 1.624435631606659      | 1                |
| 225     | Team  OnG                                              | 1.8750737480326047     | 1.624435631606659      | 3                |
| 226     | Свежие  идеи                                           | 1.8750737480326047     | 1.624435631606659      | 4                |
| 227     | Аднамок                                                | 1.8750737480326047     | 1.624435631606659      | 1                |
| 228     | MLSWAT                                                 | 1.8750737480326047     | 1.624435631606659      | 1                |
| 229     | Dark  Souls                                            | 1.8783627137540204     | 1.6246325454402781     | 1                |
| 230     | СашаДаня                                               | 1.7955695383319603     | 1.6247172275275443     | 6                |
| 231     | Newbie                                                 | 1.327405506610691      | 1.6256847653594377     | 12               |
| 232     | Easy_analytic                                          | 1.8570369691018405     | 1.627073716787785      | 4                |
| 233     | Артем  Воронов                                         | 1.8570369691018405     | 1.627073716787785      | 2                |
| 234     | Its  not a bug its a feature                           | 1.833101117003482      | 1.627073716787785      | 3                |
| 235     | dropouts                                               | 1.8570369691018405     | 1.627073716787785      | 7                |
| 236     | TeamMADEs                                              | 1.8570369691018405     | 1.627073716787785      | 26               |
| 237     | FYV                                                    | 1.8570369691018405     | 1.627073716787785      | 1                |
| 238     | LEGION                                                 | 1.8570369691018405     | 1.627073716787785      | 4                |
| 239     | Hackathonlover                                         | 1.7828099372987514     | 1.6273510358734258     | 9                |
| 240     | 50  minutes till deadline                              | 1.8020386424412642     | 1.6299096749302087     | 7                |
| 241     | 12345                                                  | 1.8750737480326047     | 1.6320918808322105     | 5                |
| 242     | Бравлеры                                               | 1.8758987433883705     | 1.6334694078811085     | 2                |
| 243     | EauDeVie                                               | 1.8675130986149782     | 1.6346500780701396     | 11               |
| 244     | Little  Quantums                                       | 1.7908074957127806     | 1.6354217317381325     | 4                |
| 245     | we_lose_team                                           | 1.8185715319815925     | 1.6365826020209993     | 11               |
| 246     | MAD  Team                                              | 1.8539483459783357     | 1.6403033540479695     | 6                |
| 247     | work_life_balance                                      | 1.864859967451456      | 1.6404512955149833     | 5                |
| 248     | Lolipop                                                | 1.797695007143365      | 1.641449717957106      | 16               |
| 249     | MAD                                                    | 1.8051741021654086     | 1.6449911909931214     | 19               |
| 250     | Overfitters                                            | 1.9370377317036414     | 1.6465712236887635     | 6                |
| 251     | на_чиле_на_расслабоне                                  | 1.877298982608269      | 1.6473146771799196     | 1                |
| 252     | Бар  для капибар                                       | 1.7585928266021618     | 1.6480867135399648     | 14               |
| 253     | Геополитические  эксперты                              | 1.7553436178705981     | 1.6555508700972403     | 11               |
| 254     | REG.RU.Team                                            | 1.831280659326789      | 1.6674089493293571     | 5                |
| 255     | Модель  строили колобки                                | 1.7835545471322518     | 1.6720505565996309     | 21               |
| 256     | Happy  Tears                                           | 1.8132884954383242     | 1.673283318803439      | 12               |
| 257     | YET_ANOTHER_HACK_TEAM                                  | 1.8550100140743484     | 1.6785921016855911     | 12               |
| 258     | DSivan                                                 | 2.0009307020998492     | 1.6838517146943577     | 1                |
| 259     | Endurance                                              | 1.9911440451139608     | 1.6861562875462326     | 3                |
| 260     | DataSatanists  (вне зачета)                            | 1.8602713914099474     | 1.6982026715287675     | 6                |
| 261     | First_Erin_Time                                        | 1.7844826245090664     | 1.7081551665051005     | 20               |
| 262     | MountHack                                              | 1.7902140194170029     | 1.7124283674332346     | 17               |
| 263     | OmegaChiDelta                                          | 1.8217561241467322     | 1.7177065662980457     | 13               |
| 264     | BoostTeam                                              | 1.780512012694581      | 1.7227404368779844     | 17               |
| 265     | Data  Wolf                                             | 1.968071911705592      | 1.729378975679473      | 1                |
| 266     | MindDriverAnalitics                                    | 1.959299608320356      | 1.7492821328078465     | 2                |
| 267     | Тимур  и его команда                                   | 1.852903977788652      | 1.7587224984724867     | 3                |
| 268     | Ruslan_Team                                            | 1.8968295273157085     | 1.7591187092373426     | 10               |
| 269     | Hello  World Team                                      | 1.4253789332593196     | 1.7596878952207362     | 10               |
| 270     | Qwerty                                                 | 2.062056888022201      | 1.7664704428967923     | 10               |
| 271     | itsok2bkeep                                            | 1.8750737480326047     | 1.7688044062966657     | 7                |
| 272     | XEXE                                                   | 1.8688978720327163     | 1.7688189342803167     | 8                |
| 273     | mango                                                  | 2.006132554372466      | 1.772477074825105      | 6                |
| 274     | Parovozik  Thomas                                      | 1.8750737480326047     | 1.7785214559068498     | 8                |
| 275     | Я  не Torch                                            | 1.8526950830674558     | 1.7802997689276543     | 5                |
| 276     | Эйнхерии                                               | 1.8744310843675982     | 1.7849687333497557     | 5                |
| 277     | rK                                                     | 1.9970776975338513     | 1.7850129187668304     | 10               |
| 278     | Джентльмены                                            | 1.8570369691018405     | 1.7895597160427765     | 11               |
| 279     | Метнулся                                               | 2.0556631334099387     | 1.8006066361119337     | 7                |
| 280     | White  Russian                                         | 2.029537205337984      | 1.8017845530783436     | 3                |
| 281     | DS  Segodnya                                           | 1.9140611112488393     | 1.8600125894390707     | 11               |
| 282     | Top1_ez                                                | 1.8750737480326047     | 1.875626313812707      | 5                |
| 283     | Hedgehogs                                              | 2.1219389186304296     | 1.8759154819387986     | 6                |
| 284     | Bla-Bla  Tech                                          | 2.095299416997358      | 1.883663377452989      | 11               |
| 285     | TeamPechenie                                           | 2.1062725650267486     | 1.8942678290886064     | 1                |
| 286     | CH_DS                                                  | 2.0881265135183207     | 1.9025591848855639     | 8                |
| 287     | Exceptional  Bear                                      | 2.137832302510562      | 1.9256109359085312     | 2                |
| 288     | SuperTeam                                              | 1.5500943377178653     | 1.9372983010979277     | 10               |
| 289     | Anatoly_Lyutov                                         | 2.3076706002120964     | 1.9518967384374277     | 3                |
| 290     | Team  Akio                                             | 2.1083881671214995     | 1.9666877963465936     | 6                |
| 291     | Juniors                                                | 1.4532707819396813     | 1.972561212704762      | 8                |
| 292     | GeoHacks                                               | 2.2778926383658638     | 2.0042442725593674     | 1                |
| 293     | BD_ML_ITMO                                             | 2.175075689079294      | 2.0148950837705453     | 6                |
| 294     | MSUS                                                   | 2.0997424277753294     | 2.024341652748502      | 14               |
| 295     | Donetsk                                                | 2.325121161548435      | 2.0517870385105548     | 1                |
| 296     | OnlyOne                                                | 2.1327491640414378     | 2.0563286034336863     | 1                |
| 297     | RAAlab                                                 | 2.2546333315401914     | 2.0597821716610354     | 16               |
| 298     | dora.team                                              | 1.75138875593841       | 2.0704524277489003     | 13               |
| 299     | Team  Daria                                            | 3.685687353013745      | 2.0705256960819134     | 3                |
| 300     | SimpleDudes                                            | 1.6998698965826824     | 2.07122724869788       | 9                |
| 301     | Team  Ink                                              | 2.1946703593830414     | 2.0818577550741146     | 4                |
| 302     | THR                                                    | 2.165086775437287      | 2.088021246654635      | 3                |
| 303     | Московские  Зайцы                                      | 2.197872781420134      | 2.0950572550187276     | 5                |
| 304     | OneMan                                                 | 2.203934950747594      | 2.1046592337687016     | 12               |
| 305     | averkho                                                | 2.2641143048794485     | 2.116235068021123      | 5                |
| 306     | platoon9                                               | 2.415508656861002      | 2.1186400087266803     | 10               |
| 307     | Continent  Media                                       | 2.277542866188316      | 2.167550147011214      | 3                |
| 308     | я  не одинок я одиночка                                | 2.165373822834278      | 2.181718335657495      | 6                |
| 309     | NickOsipov                                             | 2.363107222418939      | 2.1849556465985533     | 2                |
| 310     | Mix_team                                               | 2.481419529840848      | 2.1878635516366733     | 5                |
| 311     | MLTeam_DAR                                             | 1.8783627137540204     | 2.2244275609278867     | 3                |
| 312     | FinGuys                                                | 1.8570369691018405     | 2.2268432776957154     | 3                |
| 313     | joumateam                                              | 2.2320961895561755     | 2.2368320057221736     | 5                |
| 314     | Development  Sorcerer                                  | 2.4461713476227502     | 2.238532840280855      | 2                |
| 315     | The  Office                                            | 2.5128277873741727     | 2.250677172397581      | 11               |
| 316     | Mr.  Spocks logic                                      | 2.4218250418771006     | 2.2575167262536078     | 8                |
| 317     | DS-15  Team                                            | 2.52446862984936       | 2.269314908309888      | 7                |
| 318     | saradip  satra                                         | 1.8166408014253483     | 2.2739383468934973     | 9                |
| 319     | Data  Satanist                                         | 1.8674705924788415     | 2.2812808918421754     | 14               |
| 320     | Null_meta1                                             | 2.274079015409672      | 2.284498710719637      | 1                |
| 321     | Rat  learning                                          | 2.441161365442499      | 2.3128477563817142     | 1                |
| 322     | Saint  Peppers                                         | 1.8750737480326047     | 2.3294590548237806     | 7                |
| 323     | ЯП  DS15                                               | 1.8750737480326047     | 2.330340880908139      | 3                |
| 324     | Teamless                                               | 2.4543729505792915     | 2.343760821419898      | 3                |
| 325     | Litovka                                                | 2.504690629600416      | 2.3620793083638407     | 8                |
| 326     | KT                                                     | 1.8750737480326047     | 2.371142143303963      | 3                |
| 327     | abobamipt                                              | 2.461028283719972      | 2.427235993080315      | 3                |
| 328     | ForeverAlone                                           | 2.5227125239186408     | 2.4354092469947206     | 8                |
| 329     | Team  L                                                | 2.5376786322316383     | 2.4938073386682564     | 3                |
| 330     | ОПГ  Фламинго                                          | 2.8096190306152797     | 2.59038730097625       | 3                |
| 331     | r_test                                                 | 1.8750737480326047     | 2.624146894364811      | 5                |
| 332     | AnecBot  team                                          | 2.9503995592970393     | 2.669993377847947      | 7                |
| 333     | Data_thinkers                                          | 2.911393417432802      | 2.6987566606293845     | 1                |
| 334     | INFINITUM                                              | 2.9052392584819593     | 2.7727326583361753     | 7                |
| 335     | Team_protagonist                                       | 2.7059847881012287     | 2.7733907835420704     | 15               |
| 336     | Matrix                                                 | 2.840686740522228      | 2.79929643698805       | 3                |
| 337     | Река  Чарльз                                           | 3.1017125799162755     | 2.850631576471808      | 3                |
| 338     | Team  average_ds_enjoyer                               | 2.902461155669401      | 2.9094545740562645     | 6                |
| 339     | 42  Отщепенца                                          | 3.2084887355971774     | 3.3806803046555505     | 5                |
| 340     | GetLucky                                               | 3.441267793612503      | 3.4320359466121397     | 3                |
| 341     | RegressionProgression                                  | 1.8750737480326047     | 3.582649450736135      | 3                |
| 342     | Foxt                                                   | 4.0604881364298535     | 3.58264945076759       | 1                |
| 343     | Первый  раз                                            | 4.3642521256552556     | 3.6841094529050933     | 4                |
| 344     | Only  one                                              | 4.1898412208271125     | 3.920444893589065      | 3                |
| 345     | Team  Cuties                                           | 4.084305651306618      | 3.9364040118275043     | 2                |
| 346     | Lyceum  squad                                          | 4.438140739317119      | 4.037841810468155      | 2                |
| 347     | AntonShkvarsky                                         | 4.494592988806107      | 4.098563493071961      | 8                |
| 348     | Big  Brain Team                                        | 4.456946864537613      | 4.218985964670964      | 1                |
| 349     | team  GILbert                                          | 4.646906102113288      | 4.416698437462836      | 2                |
| 350     | Altai  Management Consulting club                      | 5.1087363377304635     | 4.948866867327453      | 2                |
| 351     | RealityLearn                                           | 5.006865837093392      | 4.997858045245074      | 3                |
| 352     | A2                                                     | 2.630732021338333      | 5.066663165356525      | 10               |
| 353     | Takstar                                                | 5.448583734609703      | 5.24728202863123       | 2                |
| 354     | 2nasty                                                 | 6.061551085057421      | 5.71815981283746       | 4                |
| 355     | ффф  (вне зачета)                                      | 5.933178764500082      | 6.006271747385888      | 2                |
| 356     | Z-team                                                 | 1.3422753491243373     | 6.351365742021707      | 8                |
| 357     | piorphi                                                | 6.619366109107396      | 6.554706788106505      | 2                |
| 358     | Team  Alpha Male                                       | 6.858762905636639      | 6.62240408913967       | 11               |
| 359     | Ись  и Ко                                              | 3.6569087570844787     | 6.986315097919384      | 7                |
| 360     | MrCockroach                                            | 8.632527693766955      | 8.584350121411973      | 3                |
| 361     | Simpozium                                              | 1.8750737480326047     | 8.897751713743803      | 5                |
| 362     | Тюлень                                                 | 8.787711654042697      | 8.924645669219032      | 1                |
| 363     | Дримтим                                                | 8.852132996551369      | 8.942736233186581      | 2                |
| 364     | Ilia  Notin                                            | 8.92200860728711       | 8.976941749784837      | 2                |
| 365     | NDS                                                    | 9                      | 9                      | 1                |
| 366     | overfitting                                            | 9.841789648377278      | 9.876170965768868      | 1                |
| 367     | juan.                                                  | 09.сен                 | 9.900000000000002      | 1                |
| 368     | Team  Plyusch                                          | 09.сен                 | 9.900000000000002      | 1                |
| 369     | Team  Peaches                                          | 09.сен                 | 9.900000000000002      | 1                |
| 370     | Дрим  Тим                                              | 09.сен                 | 9.900000000000002      | 4                |
| 371     | conTENT                                                | 09.сен                 | 9.900000000000002      | 1                |
| 372     | why-ds                                                 | 09.сен                 | 9.900000000000002      | 1                |
| 373     | Nick                                                   | 09.сен                 | 9.900000000000002      | 1                |
| 374     | Space  Cowgirl                                         | 9.882557040187425      | 9.900000000000002      | 1                |
| 375     | Shaman_s_bubnom_and_tanchami                           | 09.сен                 | 9.900000000000002      | 1                |
| 376     | Amoguses                                               | 09.сен                 | 9.900000000000002      | 1                |
| 377     | TeamBBZ                                                | 0                      | 0                      | 0                |

# Описание от организаторов хакатона
Это бенчмарк скрипт для хакатона от Раййфайзенбанка по оценке коммерческой недвижимости
Бенчмарк состоит из:
* pyproject.toml - конфигурационный файл для менеджера пакетов poetry (https://python-poetry.org/) - в интернете есть много статей, посвященных ему (например https://habr.com/ru/post/455335/ и https://khashtamov.com/ru/python-poetry-dependency-management/)
* requirements.txt - стандартный requirements для pip
* train.py - скрипт, который обучает модель и сохраняет ее
* predict.py - скрипт, который делает предсказание на отложенной тестовой выборке

## Запуск

`python train.py --train_data '../../data/2021_raifhack/data/train.csv' --model_path 2021.09.24_21.05_model.pkl`

`python predict.py --test_data ../../data/2021_raifhack/data/test.csv --model_path 2021.09.24_21.05_model.pkl --output ../../data/2021_raifhack/output/2021.09.24_22.26.csv`

### Вариант с poetry
**Крайне рекомендую именно установку с poetry** - poetry это новый packet manager для питона, и он гораздо круче чем pip. Разобравшись с ним (а это очень-очень просто), думаю, вы будете необычайно счастливы.
Для запуска необходимо:
<ol>
    <li> убедиться, что у вас стоит python3.6 или выше </li>
    <li> установить poetry:

     pip install poetry 
</li>
    <li> установить все нужные пакеты из poetry.lock:
    <ol>
        <li> по умолчанию poetry создает виртуальное окружение - это лучше для изоляции от вашей системы и рекомендуем именно такой способ установи пакетов:
            
         poetry  install  
</li>
        <li> если хочется установить без виртуального окружения, то установить нужно с помощью следующей команды:
            
        poetry config virtualenvs.create false && poetry  install
</li>
    </ol> 
    </li>
    <li> запустить обучение

    poetry run python3 train.py --train_data <path_to_train_data> --model_path <path_to_pickle_ml_model>
</li>
    <li> запустить предикт

    poetry run python3 predict.py --model_path <path_to_pickled_model> --test_data <path_to_test_data> --output <path_to_output_csv_file>
</li>
    <li> загрузить полученные результаты в систему </li>
</ol>
## Вариант с requirements.txt
<ol>
    <li> убедиться, что у вас стоит python3.6 или выше </li>
    <li> установить зависимости:

    pip install -r requirements.txt 
</li>
    <li> запустить обучение

    python3 train.py --train_data <path_to_train_data> --model_path <path_to_pickle_ml_model>
</li>
    <li> запустить предикт
    
    python3 predict.py --model_path <path_to_pickled_model> --test_data <path_to_test_data> --output <path_to_output_csv_file>
</li>
    <li> загрузить полученные результаты в систему</li>
</ol>

В репозитории есть своя реализация регуляризованного target encoding (SmoothedTargetEncoding). можно поэкспериментировать с ним

**Памятка хакера**: https://russianhackers.notion.site/Raifhack-DS-266336ee6b7640c691364a9bb49885dd